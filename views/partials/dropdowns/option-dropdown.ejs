<!--
    group: { id, select, req },
    label: { id, content },
    options:[{ value, content }, ... ]
-->

<div id="<%= group.id %>" class="selectContainer">
  <select
    id="<%= group.select %>"
    name="<%= group.select %>"
    <%= group.req ? 'required' : '' %>
  >
    <option value=""></option>
    <% options.forEach(op => { %>
      <option value="<%= op.value %>"><%= op.content %></option>
    <% }); %>
  </select>
  <label
    for="<%= group.select %>"
    id="<%= label.id %>"
    class="vp hp"
  >
    <%= label.content %>
  </label>
</div>

<script type="module">
  import { radius } from '/js/utils.js';

  ((d) => {
    const select = d.getElementById('<%= group.select %>');
    const label = d.getElementById('<%= label.id %>');

    // --- Inicializa el estado global si no existe
    if (!window.selectStates) window.selectStates = {};
    selectStates['<%= group.select %>'] = {
      state: false,
      label,
      select
    };

    // --- Funci√≥n auxiliar
    function updateLabelState() {
      if (select.value) {
        label.classList.add('active', 'correct');
        select.classList.add('correct');
        selectStates['<%= group.select %>'].state = true;
      } else {
        label.classList.remove('correct');
        select.classList.remove('correct');
        selectStates['<%= group.select %>'].state = false;
        // Quita "active" solo si no tiene foco
        if (document.activeElement !== select) {
          label.classList.remove('active');
        }
      }
    }

    // --- Listeners
    select.addEventListener('focus', () => {
      label.classList.add('active');
    });

    select.addEventListener('blur', updateLabelState);
    select.addEventListener('change', updateLabelState);

    // --- Inicializar
    updateLabelState();

    // --- Aplica radio al select
    radius(select);
  })(document);
</script>